<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Отзывы | Liquid Glass</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS (CDN for standalone usage) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        glass: 'rgba(255, 255, 255, 0.1)',
                    }
                }
            }
        }
    </script>

    <!-- Custom Styles & Animations -->
    <style>
        body {
            background-color: #0f172a;
            color: white;
            overflow-x: hidden;
        }

        /* Ambient Background Animation */
        .ambient-light {
            position: fixed;
            border-radius: 50%;
            filter: blur(100px);
            z-index: -1;
            opacity: 0.4;
            animation: pulse 8s infinite alternate;
        }
        
        .blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: #9333ea; }
        .blob-2 { bottom: -10%; right: -10%; width: 50vw; height: 50vw; background: #2563eb; animation-delay: 2s; }
        .blob-3 { top: 30%; right: 20%; width: 30vw; height: 30vw; background: #db2777; animation-delay: 4s; opacity: 0.2; }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.3; }
            100% { transform: scale(1.1); opacity: 0.5; }
        }

        /* Glass Effect */
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        /* Animations */
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }

        .review-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .review-item:hover {
            transform: translateY(-2px) scale(1.01);
            background: rgba(255, 255, 255, 0.1);
        }

        .loader {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-left-color: #ec4899;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen relative">

    <!-- Background Blobs -->
    <div class="ambient-light blob-1"></div>
    <div class="ambient-light blob-2"></div>
    <div class="ambient-light blob-3"></div>

    <div class="relative z-10 max-w-2xl mx-auto px-4 py-16 flex flex-col gap-8">
        
        <!-- Header -->
        <div class="text-center space-y-3 fade-in-up" style="animation-delay: 0.1s">
            <div class="inline-flex items-center justify-center px-4 py-2 rounded-full bg-white/5 border border-white/10 mb-2">
                <svg class="w-5 h-5 text-pink-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg>
                <span class="text-sm font-medium tracking-wide text-pink-100/90">Отзывы клиентов</span>
            </div>
            <h1 class="text-4xl md:text-5xl font-bold font-display bg-clip-text text-transparent bg-gradient-to-r from-white via-pink-100 to-blue-100">
                Ваше мнение важно
            </h1>
            <p class="text-slate-400 font-sans max-w-md mx-auto leading-relaxed">
                Мы ценим каждый отзыв. Оставьте свое мнение, чтобы помочь нам стать лучше.
            </p>
        </div>

        <!-- Notification Area -->
        <div id="notification-area" class="fade-in-up" style="animation-delay: 0.2s"></div>

        <!-- Form -->
        <div class="fade-in-up" style="animation-delay: 0.3s">
            <form id="review-form" class="glass-panel rounded-3xl p-6 md:p-8 relative overflow-hidden group">
                <div class="absolute inset-0 bg-gradient-to-b from-white/5 to-transparent pointer-events-none"></div>
                
                <h3 class="text-xl font-semibold font-display mb-6 flex items-center gap-2">
                    <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg>
                    Оставить отзыв
                </h3>

                <div class="space-y-5">
                    <div class="space-y-2">
                        <label for="name" class="text-sm font-medium text-slate-300 ml-1">Ваше имя</label>
                        <div class="relative">
                            <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                            <input type="text" id="name" required placeholder="Иван Петров" 
                                class="w-full bg-slate-900/50 border border-white/10 text-white placeholder:text-slate-600 rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-pink-500/50 transition-all hover:bg-slate-900/70">
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label for="message" class="text-sm font-medium text-slate-300 ml-1">Текст отзыва</label>
                        <textarea id="message" required placeholder="Напишите здесь..." rows="4"
                            class="w-full bg-slate-900/50 border border-white/10 text-white placeholder:text-slate-600 rounded-xl py-3 px-4 resize-none focus:outline-none focus:ring-2 focus:ring-pink-500/50 transition-all hover:bg-slate-900/70"></textarea>
                    </div>

                    <button type="submit" id="submit-btn"
                        class="w-full bg-gradient-to-r from-pink-500 to-violet-600 hover:from-pink-400 hover:to-violet-500 text-white font-semibold py-3.5 rounded-xl transition-all duration-300 transform hover:scale-[1.01] hover:shadow-lg hover:shadow-pink-500/25 flex items-center justify-center gap-2">
                        <span id="btn-text">Отправить отзыв</span>
                        <div id="btn-loader" class="loader hidden"></div>
                    </button>
                </div>
            </form>
        </div>

        <!-- Reviews List -->
        <div class="space-y-4 fade-in-up" style="animation-delay: 0.4s">
            <h3 class="text-2xl font-display font-semibold pl-2 text-white/90">Последние отзывы</h3>
            <div id="reviews-container" class="space-y-4 min-h-[100px]">
                <!-- Reviews will be loaded here -->
                <div class="flex justify-center py-8">
                    <div class="loader"></div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="text-center py-6 text-sm text-white/30 font-sans fade-in-up" style="animation-delay: 0.5s">
            Designed by Davit
        </footer>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // ===============================================================
        // ⚙️ API SHEETDB
        // ===============================================================
        const SHEETDB_API_URL = 'https://sheetdb.io/api/v1/bob7yn7ganvyn'; 
        // ===============================================================

        const form = document.getElementById('review-form');
        const reviewsContainer = document.getElementById('reviews-container');
        const submitBtn = document.getElementById('submit-btn');
        const btnText = document.getElementById('btn-text');
        const btnLoader = document.getElementById('btn-loader');
        const notificationArea = document.getElementById('notification-area');

        // Check if Demo Mode
        const isDemoMode = !SHEETDB_API_URL || SHEETDB_API_URL === '';

        // Initial Load
        document.addEventListener('DOMContentLoaded', () => {
            if (isDemoMode) {
                showNotification('warning', 'Демо-режим: API ссылка не установлена. Отзывы не будут сохраняться в таблицу.');
                loadDemoReviews();
            } else {
                fetchReviews();
            }
        });

        // Handle Form Submit
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('name').value.trim();
            const message = document.getElementById('message').value.trim();
            
            if (!name || !message) return;

            setLoading(true);

            const newReview = {
                id: Date.now().toString(),
                name: name,
                message: message,
                date: new Date().toISOString()
            };

            if (isDemoMode) {
                // Simulate network request
                await new Promise(r => setTimeout(r, 1000));
                renderReview(newReview, true); // Prepend
                form.reset();
                showNotification('success', 'Отзыв добавлен (Демо)!');
                setLoading(false);
                return;
            }

            try {
                // Send to SheetDB
                await fetch(SHEETDB_API_URL, {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ data: newReview })
                });

                renderReview(newReview, true);
                form.reset();
                showNotification('success', 'Отзыв успешно отправлен!');
            } catch (error) {
                console.error('Error:', error);
                showNotification('error', 'Ошибка отправки. Попробуйте позже.');
            } finally {
                setLoading(false);
            }
        });

        // Fetch Reviews from API
        async function fetchReviews() {
            try {
                const response = await fetch(SHEETDB_API_URL);
                const data = await response.json();
                
                reviewsContainer.innerHTML = '';
                
                if (Array.isArray(data) && data.length > 0) {
                    // Sort by date descending if possible, or just reverse if SheetDB appends
                    data.reverse().forEach(review => renderReview(review));
                } else {
                    reviewsContainer.innerHTML = '<div class="text-center text-slate-500 py-4">Пока нет отзывов.</div>';
                }
            } catch (error) {
                console.error('Fetch error:', error);
                reviewsContainer.innerHTML = '<div class="text-center text-red-400 py-4">Не удалось загрузить отзывы.</div>';
            }
        }

        function loadDemoReviews() {
            reviewsContainer.innerHTML = '';
            const demoData = [
                { id: '1', name: 'Алексей', message: 'Отличный дизайн! Выглядит очень современно.', date: new Date().toISOString() },
                { id: '2', name: 'Мария', message: 'Всё работает быстро и удобно. Спасибо!', date: new Date(Date.now() - 86400000).toISOString() }
            ];
            demoData.forEach(review => renderReview(review));
        }

        // Render Single Review Card
        function renderReview(review, prepend = false) {
            const dateStr = new Date(review.date).toLocaleDateString('ru-RU', {
                day: 'numeric', month: 'long', hour: '2-digit', minute: '2-digit'
            });
            
            const initial = review.name.charAt(0).toUpperCase();

            const html = `
                <div class="glass-panel rounded-2xl p-5 review-item animate-slide-in">
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-pink-400 to-violet-500 flex items-center justify-center shrink-0 text-white font-bold text-lg shadow-lg">
                            ${initial}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-1">
                                <h4 class="font-display font-medium text-white text-lg truncate pr-4">${escapeHtml(review.name)}</h4>
                                <span class="text-xs text-slate-400 font-sans">${dateStr}</span>
                            </div>
                            <p class="text-slate-200 font-sans leading-relaxed break-words">${escapeHtml(review.message)}</p>
                        </div>
                    </div>
                </div>
            `;

            if (prepend) {
                // If container has "no reviews" message, clear it first
                if (reviewsContainer.children[0]?.classList.contains('text-center')) {
                    reviewsContainer.innerHTML = '';
                }
                reviewsContainer.insertAdjacentHTML('afterbegin', html);
                
                // Add animation class to the new element
                const newElem = reviewsContainer.firstElementChild;
                newElem.style.animation = 'fadeInUp 0.5s ease-out forwards';
            } else {
                reviewsContainer.insertAdjacentHTML('beforeend', html);
            }
        }

        function setLoading(state) {
            if (state) {
                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-70', 'cursor-not-allowed');
                btnText.classList.add('hidden');
                btnLoader.classList.remove('hidden');
            } else {
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-70', 'cursor-not-allowed');
                btnText.classList.remove('hidden');
                btnLoader.classList.add('hidden');
            }
        }

        function showNotification(type, text) {
            const colors = {
                success: 'bg-green-500/20 border-green-500/30 text-green-100',
                error: 'bg-red-500/20 border-red-500/30 text-red-100',
                warning: 'bg-amber-500/20 border-amber-500/30 text-amber-100'
            };
            
            notificationArea.innerHTML = `
                <div class="p-4 rounded-xl backdrop-blur-md border flex items-center gap-3 ${colors[type]}">
                    <span>${text}</span>
                </div>
            `;
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }
    </script>
</body>
</html>